<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcanecoder: O Syllabus Arcano</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Source+Code+Pro&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #0d0a1a;
            --panel-bg: #1a1433e0;
            --primary-glow: #e44d26; /* Cor Padr√£o (HTML Orange) */
            --secondary-glow: #f16529;
            --text-color: #e0e0e0;
            --success-color: #00ff9b;
            --error-color: #ff5e5e;
            --font-title: 'Cinzel', serif;
            --font-code: 'Source Code Pro', monospace;
            --transition-speed: 0.5s;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at 20% 20%, var(--secondary-glow) -10%, transparent 40%),
                              radial-gradient(circle at 80% 70%, var(--primary-glow) -10%, transparent 40%);
            font-family: var(--font-code);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            transition: background-image var(--transition-speed) ease;
        }

        #game-wrapper {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 20px;
            width: 100%;
            max-width: 1200px;
            height: 90vh;
            max-height: 800px;
        }

        .game-panel {
            background: var(--panel-bg);
            border: 1px solid var(--primary-glow);
            border-radius: 15px;
            box-shadow: 0 0 15px var(--primary-glow);
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: border-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
        }
        
        #world-panel { gap: 20px; }
        #character-box { display: flex; align-items: center; gap: 15px; }
        
        #character-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: var(--secondary-glow);
            border: 2px solid var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            flex-shrink: 0;
            transition: background-color var(--transition-speed) ease;
        }

        #character-dialogue-box { flex: 1; }
        #character-name { font-family: var(--font-title); color: var(--primary-glow); margin-bottom: 5px; transition: color var(--transition-speed) ease; }
        #character-dialogue { font-style: italic; font-size: 0.9rem; line-height: 1.4; }

        #spell-output-wrapper {
            flex-grow: 1;
            background-color: rgba(0,0,0,0.3);
            border-radius: 10px;
            border: 1px dashed var(--secondary-glow);
            padding: 15px;
            overflow-y: auto;
            transition: border-color var(--transition-speed) ease;
        }
        
        #spell-output-wrapper h3 { font-family: var(--font-title); text-align: center; margin-bottom: 15px; color: var(--secondary-glow); transition: color var(--transition-speed) ease; }
        #spell-output p, #spell-output h1, #spell-output h2, #spell-output div, #spell-output ul, #spell-output ol, #spell-output button, #spell-output pre { margin-bottom: 10px; }
        #spell-output pre { background-color: #000; padding: 10px; border-radius: 5px; white-space: pre-wrap; word-wrap: break-word; }

        #challenge-panel h2 { font-family: var(--font-title); text-align: center; color: var(--primary-glow); transition: color var(--transition-speed) ease; }
        
        #progress-bar-container { width: 100%; height: 10px; background-color: #000; border-radius: 5px; margin: 10px 0 20px 0; border: 1px solid var(--secondary-glow); transition: border-color var(--transition-speed) ease; }
        #progress-bar-fill { width: 0%; height: 100%; background: linear-gradient(90deg, var(--secondary-glow), var(--primary-glow)); border-radius: 5px; transition: width 0.5s ease-in-out, background var(--transition-speed) ease; }

        #challenge-text { line-height: 1.5; flex-grow: 1; }
        #code-input { width: 100%; height: 200px; background-color: #0d0a1a; color: var(--success-color); border: 1px solid var(--secondary-glow); border-radius: 5px; font-family: inherit; font-size: 1rem; padding: 10px; margin-top: 10px; resize: none; transition: border-color var(--transition-speed) ease; }
        #code-input:focus { outline: none; box-shadow: 0 0 10px var(--secondary-glow); transition: box-shadow var(--transition-speed) ease; }
        
        .button-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            align-items: stretch;
        }

        #submit-button { 
            background: linear-gradient(45deg, var(--secondary-glow), var(--primary-glow)); 
            color: white; border: none; 
            padding: 12px; 
            font-family: var(--font-title); 
            font-size: 1.2rem; 
            cursor: pointer; 
            border-radius: 5px; 
            transition: transform 0.2s, box-shadow 0.2s, background var(--transition-speed) ease;
            flex-grow: 1;
        }
        #submit-button:hover { transform: scale(1.02); box-shadow: 0 0 20px var(--primary-glow); }
        
        .side-buttons {
            display: flex;
            gap: 5px;
        }

        .side-buttons button {
            background: #444;
            color: white;
            border: 1px solid #666;
            padding: 0 15px;
            font-family: var(--font-code);
            font-size: 0.8rem;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        
        .side-buttons button:hover {
            background-color: #666;
        }

        #reset-button:hover {
            background-color: var(--error-color);
        }

        #feedback-box { display: flex; align-items: center; gap: 10px; margin-top: 10px; min-height: 24px; }
        .feedback-icon { width: 20px; height: 20px; display: none; flex-shrink: 0; }
        #feedback-text { font-weight: bold; }
        
        @media (max-width: 900px) {
            body { padding: 10px; align-items: flex-start; }
            #game-wrapper { grid-template-columns: 1fr; height: auto; max-height: none; gap: 10px; }
            .game-panel { padding: 15px; }
            #code-input { height: 150px; }
        }
    </style>
</head>
<body>

    <div id="game-wrapper">
        <div id="world-panel" class="game-panel">
            <div id="character-box"> <div id="character-avatar">üßô</div> <div id="character-dialogue-box"> <h3 id="character-name">Mestre Elara</h3> <p id="character-dialogue">Bem-vindo, aprendiz.</p> </div> </div>
            <div id="spell-output-wrapper"> <h3>Seu Grim√≥rio</h3> <div id="spell-output"> </div> </div>
        </div>
        <div id="challenge-panel" class="game-panel">
            <h2 id="chapter-title"></h2>
            <div id="progress-bar-container"> <div id="progress-bar-fill"></div> </div>
            <p id="challenge-text"></p>
            <textarea id="code-input" spellcheck="false"></textarea>
            <div class="button-container">
                <button id="submit-button">Conjurar</button>
                <div class="side-buttons">
                    <button id="save-button" title="Salvar Progresso em Arquivo">Salvar</button>
                    <button id="import-button" title="Importar Progresso de Arquivo">Importar</button>
                    <button id="reset-button" title="Resetar Progresso">Reset</button>
                </div>
            </div>
            <input type="file" id="import-file-input" accept=".txt" style="display: none;">
            <div id="feedback-box">
                <svg id="icon-success" class="feedback-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 6L9 17L4 12" stroke="var(--success-color)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <svg id="icon-error" class="feedback-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6l12 12" stroke="var(--error-color)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <span id="feedback-text"></span>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const spellOutput = document.getElementById('spell-output');
            const challengeText = document.getElementById('challenge-text');
            const codeInput = document.getElementById('code-input');
            const submitButton = document.getElementById('submit-button');
            const resetButton = document.getElementById('reset-button');
            const saveButton = document.getElementById('save-button');
            const importButton = document.getElementById('import-button');
            const importFileInput = document.getElementById('import-file-input');
            const feedbackText = document.getElementById('feedback-text');
            const chapterTitle = document.getElementById('chapter-title');
            const progressBarFill = document.getElementById('progress-bar-fill');
            const characterDialogue = document.getElementById('character-dialogue');
            const iconSuccess = document.getElementById('icon-success');
            const iconError = document.getElementById('icon-error');
            const styleTag = document.createElement('style');
            document.head.appendChild(styleTag);
            
            const savedStateJSON = localStorage.getItem('arcanecoderSave');
            let gameState = savedStateJSON ? JSON.parse(savedStateJSON) : { currentLevel: 0 };


            const chapterThemes = {
                '1: Invoca√ß√£o (HTML)': { primary: '#e44d26', secondary: '#f16529' },
                '2: Encantamentos (CSS)': { primary: '#264de4', secondary: '#2965f1' },
                '3: Anima√ß√£o (JavaScript)': { primary: '#f0db4f', secondary: '#f7df1e' },
                '4: Alquimia (React)': { primary: '#61dafb', secondary: '#a8e9ff' },
                '5: Rituais do Servidor (Node)': { primary: '#339933', secondary: '#68a063' },
                '6: Pactos de Dados (APIs & SQL)': { primary: '#A0A0A0', secondary: '#cccccc' },
                '7: Magia da Serpente (Python)': { primary: '#3776ab', secondary: '#ffd43b' }
            };

            const levels = [
                // CAP√çTULO 1: HTML (15 Fases)
                ...Array.from({ length: 15 }, (_, i) => ({ chapter: '1: Invoca√ß√£o (HTML)', type: 'html', ...getHtmlLevel(i) })),
                // CAP√çTULO 2: CSS (15 Fases)
                ...Array.from({ length: 15 }, (_, i) => ({ chapter: '2: Encantamentos (CSS)', type: 'css', ...getCssLevel(i) })),
                // CAP√çTULO 3: JavaScript (15 Fases)
                ...Array.from({ length: 15 }, (_, i) => ({ chapter: '3: Anima√ß√£o (JavaScript)', type: 'js', ...getJsLevel(i) })),
                // CAP√çTULO 4: React (15 Fases)
                ...Array.from({ length: 15 }, (_, i) => ({ chapter: '4: Alquimia (React)', type: 'react', ...getReactLevel(i) })),
                // CAP√çTULO 5: Node.js (15 Fases)
                ...Array.from({ length: 15 }, (_, i) => ({ chapter: '5: Rituais do Servidor (Node)', type: 'node', ...getNodeLevel(i) })),
                // CAP√çTULO 6: APIs & SQL (15 Fases)
                ...Array.from({ length: 15 }, (_, i) => ({ chapter: '6: Pactos de Dados (APIs & SQL)', type: 'api-sql', ...getApiSqlLevel(i) })),
                // CAP√çTULO 7: Python (15 Fases) - B√îNUS
                ...Array.from({ length: 15 }, (_, i) => ({ chapter: '7: Magia da Serpente (Python)', type: 'python', ...getPythonLevel(i) })),
            ];

            function getHtmlLevel(i) { /* Retorna dados da fase HTML */
                const data = [
                    {d: "Todo grande tomo precisa de um t√≠tulo. Use h1 para 'O Livro dos Feiti√ßos'.", c: "Invoque um t√≠tulo principal (h1) com o texto 'O Livro dos Feiti√ßos'.", s: "<h1>O Livro dos Feiti√ßos</h1>"},
                    {d: "Descreva sua finalidade com um par√°grafo.", c: "Use uma tag de par√°grafo (<p>) para 'Cont√©m os segredos da cria√ß√£o.'", s: "<p>Cont√©m os segredos da cria√ß√£o.</p>"},
                    {d: "Adicione uma sec√ß√£o com um subt√≠tulo h2.", c: "Crie um subt√≠tulo (h2) com 'Elementos Primordiais'.", s: "<h2>Elementos Primordiais</h2>"},
                    {d: "Organize a magia com listas.", c: "Crie uma lista n√£o ordenada (<ul>) com itens (<li>): 'Estrutura' e 'Estilo'.", s: "<ul><li>Estrutura</li><li>Estilo</li></ul>"},
                    {d: "Separe os cantos com uma linha divis√≥ria.", c: "Crie uma linha horizontal com a tag <hr>.", s: "<hr>"},
                    {d: "Invoque uma div para um feiti√ßo poderoso.", c: "Crie uma tag div com id='aura-magica'.", s: "<div id='aura-magica'></div>"},
                    {d: "Crie um portal para outras magias.", c: "Crie um link (<a>) com href='#' e texto 'Portal Vazio'.", s: "<a href='#'>Portal Vazio</a>"},
                    {d: "Invoque uma imagem de uma 'Runa de Poder'.", c: "Crie uma imagem (<img>) com src='https://placehold.co/100x100/e44d26/white?text=Runa' e alt='Runa de Poder'.", s: "<img src='https://placehold.co/100x100/e44d26/white?text=Runa' alt='Runa de Poder'>"},
                    {d: "Destaque palavras com poder.", c: "Crie um par√°grafo: 'O <strong>poder</strong> est√° no conhecimento.'", s: "<p>O <strong>poder</strong> est√° no conhecimento.</p>"},
                    {d: "D√™ √™nfase a outras palavras.", c: "Crie um par√°grafo: 'Devemos <em>sempre</em> aprender.'", s: "<p>Devemos <em>sempre</em> aprender.</p>"},
                    {d: "A ordem √© crucial. Use uma lista ordenada.", c: "Crie uma lista ordenada (<ol>) com itens (<li>): 'Preparar', 'Conjurar', 'Observar'.", s: "<ol><li>Preparar</li><li>Conjurar</li><li>Observar</li></ol>"},
                    {d: "Invoque um gatilho para a magia.", c: "Crie um bot√£o (<button>) com o texto 'Ativar'.", s: "<button>Ativar</button>"},
                    {d: "Marque uma palavra para futuros encantamentos.", c: "Par√°grafo: 'A <span id='foco-magico'>magia</span> flui.'", s: "<p>A <span id='foco-magico'>magia</span> flui.</p>"},
                    {d: "Deixe notas invis√≠veis no c√≥digo.", c: "Adicione um coment√°rio HTML: <!-- Meus Feiti√ßos -->", s: "<!-- Meus Feiti√ßos -->"},
                    {d: "Combine feiti√ßos numa div com classe 'ritual'.", c: "Crie <div class='ritual'> com <h2>Ritual</h2> e <p>Teste.</p> dentro.", s: "<div class='ritual'><h2>Ritual</h2><p>Teste.</p></div>"}
                ];
                return { dialogue: data[i].d, challenge: data[i].c, solution: data[i].s };
            }
            function getCssLevel(i) { /* Retorna dados da fase CSS */ 
                const data = [
                    {d: "Imbua o grim√≥rio com cor. Use 'aqua' no t√≠tulo principal.", c: "Altere a cor (color) de todos os h1 para 'aqua'.", s: "h1 { color: aqua; }"},
                    {d: "D√™ forma e subst√¢ncia √† aura que voc√™ criou.", c: "Para #aura-magica, defina width e height de '100px' e background-color de 'gold'.", s: "#aura-magica{width:100px;height:100px;background-color:gold;}"},
                    {d: "Transforme a aura quadrada num orbe perfeito.", c: "Fa√ßa a #aura-magica ser um c√≠rculo com border-radius: 50%.", s: "#aura-magica{border-radius:50%;}"},
                    {d: "Fa√ßa o orbe pulsar com energia. Adicione uma borda.", c: "Adicione uma border de '3px solid purple' √† #aura-magica.", s: "#aura-magica{border:3px solid purple;}"},
                    {d: "Destaque a palavra 'magia' que marcou.", c: "Selecione #foco-magico e mude a sua cor para 'yellow'.", s: "#foco-magico{color:yellow;}"},
                    {d: "A fonte pode ser mais m√≠stica.", c: "Mude o font-family de todos os <p> para 'serif'.", s: "p { font-family: serif; }"},
                    {d: "Centralize os seus t√≠tulos.", c: "Use text-align: center; em todos os h2.", s: "h2 { text-align: center; }"},
                    {d: "O orbe precisa de espa√ßo para respirar.", c: "Adicione um padding de '10px' a #aura-magica.", s: "#aura-magica{padding:10px;}"},
                    {d: "Afaste o orbe dos outros elementos.", c: "Adicione uma margin de '20px' a #aura-magica.", s: "#aura-magica{margin:20px;}"},
                    {d: "Remova a distra√ß√£o do sublinhado do portal.", c: "Remova o text-decoration: none de todos os links (<a>).", s: "a { text-decoration: none; }"},
                    {d: "Fa√ßa o seu ritual brilhar com uma sombra m√°gica.", c: "Adicione um box-shadow de '0 0 10px cyan' √† classe 'ritual'.", s: ".ritual{box-shadow:0 0 10px cyan;}"},
                    {d: "A magia deve reagir ao seu toque.", c: "Use a pseudo-classe :hover no button para mudar o background-color para 'cyan'.", s: "button:hover{background-color:cyan;}"},
                    {d: "Indique que o bot√£o √© interativo.", c: "Mude o cursor para 'pointer' quando estiver sobre qualquer button.", s: "button{cursor:pointer;}"},
                    {d: "Suavize a transi√ß√£o de cor do bot√£o.", c: "Adicione uma transition de 'background-color 0.3s ease' ao button.", s: "button{transition:background-color 0.3s ease;}"},
                    {d: "D√™ espa√ßo ao texto dentro da sec√ß√£o do ritual.", c: "Adicione um padding de '15px' √† classe 'ritual'.", s: ".ritual{padding:15px;}"}
                ];
                return { dialogue: data[i].d, challenge: data[i].c, solution: data[i].s };
            }
            function getJsLevel(i) { /* Retorna dados da fase JS */
                const data = [
                    {d:"O mundo precisa reagir a si. Crie um 'Cristal de Intera√ß√£o'.", c:"Crie um bot√£o com id 'cristal' e texto 'Tocar'. Adicione-o ao grim√≥rio.", s:`const c=document.createElement('button');c.id='cristal';c.textContent='Tocar';spellOutput.appendChild(c);`, v:()=>document.getElementById('cristal')!==null},
                    {d:"O cristal est√° inerte. Ensine-o a reagir ao toque.", c:"Adicione um evento de clique (click) ao 'cristal' que mostre um alert com 'Energia liberada!'.", s:`document.getElementById('cristal').addEventListener('click',()=>{alert('Energia liberada!');});`, v:()=>{characterDialogue.textContent="Teste o cristal que conjurou.";return true;}},
                    {d:"Crie um feiti√ßo reutiliz√°vel com uma fun√ß√£o.", c:"Crie uma fun√ß√£o 'pulsarOrbe' que muda o background da 'aura-magica' para 'blueviolet'.", s:`function pulsarOrbe(){document.getElementById('aura-magica').style.backgroundColor='blueviolet';}`, v:()=>typeof pulsarOrbe==='function'},
                    {d:"Agora, liberte a magia que preparou!", c:"Execute a fun√ß√£o 'pulsarOrbe()'.", s:`pulsarOrbe();`, v:()=>document.getElementById('aura-magica').style.backgroundColor==='blueviolet'},
                    {d:"Guarde uma informa√ß√£o m√°gica numa vari√°vel.", c:"Declare uma vari√°vel 'mana' com 'let' e atribua-lhe o valor 100.", s:`let mana=100;`, v:()=>typeof mana!=='undefined'&&mana===100},
                    {d:"Altere o texto de um elemento com magia.", c:"Selecione o primeiro 'p' e mude o seu textContent para 'Os segredos foram revelados.'", s:`document.querySelector('p').textContent='Os segredos foram revelados.';`, v:()=>document.querySelector('p').textContent==='Os segredos foram revelados.'},
                    {d:"Reescreva a estrutura! Adicione um item √† sua lista.", c:"Selecione a 'ul' e adicione '<li>Anima√ß√£o</li>' ao seu innerHTML.", s:`document.querySelector('ul').innerHTML+='<li>Anima√ß√£o</li>';`, v:()=>document.querySelector('ul').innerHTML.includes('<li>Anima√ß√£o</li>')},
                    {d:"Aponte a sua magia para a sec√ß√£o do ritual.", c:"Use document.querySelector('.ritual') e guarde o elemento numa vari√°vel 'sec√ß√£oRitual'.", s:`const sec√ß√£oRitual=document.querySelector('.ritual');`, v:()=>typeof sec√ß√£oRitual!=='undefined'&&sec√ß√£oRitual.classList.contains('ritual')},
                    {d:"Inspecione a sua runa. Obtenha o seu endere√ßo.", c:"Obtenha o atributo 'src' da sua 'img' e exiba-o num alert.", s:`alert(document.querySelector('img').getAttribute('src'));`, v:()=>{characterDialogue.textContent="Execute e veja o resultado.";return true;}},
                    {d:"Mude a runa! Altere o seu poder visualmente.", c:"Mude o 'src' da 'img' para 'https://placehold.co/100x100/f0db4f/black?text=JS'.", s:`document.querySelector('img').setAttribute('src','https://placehold.co/100x100/f0db4f/black?text=JS');`, v:()=>document.querySelector('img').src.includes('f0db4f')},
                    {d:"A magia precisa de l√≥gica. Use uma instru√ß√£o 'if'.", c:"Se 'mana > 50', mude a cor da borda do orbe para 'cyan'.", s:`if(mana>50){document.getElementById('aura-magica').style.borderColor='cyan';}`, v:()=>document.getElementById('aura-magica').style.borderColor==='cyan'},
                    {d:"Gaste um pouco de mana.", c:"Subtraia 20 da sua vari√°vel 'mana'.", s:`mana=mana-20;`, v:()=>mana===80},
                    {d:"Combine texto e vari√°veis para mensagens din√¢micas.", c:"Crie um alert que diga 'Mana restante: ' seguido do valor de 'mana'.", s:`alert('Mana restante: '+mana);`, v:()=>{characterDialogue.textContent="Verifique a sua reserva.";return true;}},
                    {d:"Adicione uma classe de encantamento ao seu ritual.", c:"Adicione a classe 'encantado' √† div com a classe 'ritual'.", s:`document.querySelector('.ritual').classList.add('encantado');`, v:()=>document.querySelector('.ritual').classList.contains('encantado')},
                    {d:"√Äs vezes, √© preciso remover um encantamento.", c:"Remova a classe 'encantado' da div com a classe 'ritual'.", s:`document.querySelector('.ritual').classList.remove('encantado');`, v:()=>!document.querySelector('.ritual').classList.contains('encantado')}
                ];
                return { dialogue: data[i].d, challenge: data[i].c, solution: data[i].s, validation: data[i].v };
            }
            function getReactLevel(i) { /* Retorna dados da fase React */
                const data = [
                    {d:"React √© a magia de criar componentes reutiliz√°veis. Vamos simular a sua escrita. Comece com um componente funcional.", c:"Escreva um componente funcional 'Saudacao' que retorna um <h1>Ol√°, Mundo Arcano</h1>.", s:"function Saudacao(){return <h1>Ol√°, Mundo Arcano</h1>;}"},
                    {d:"Componentes podem ser din√¢micos com 'props'.", c:"Crie um componente 'Feitico' que aceita 'props' e retorna um <p>Feiti√ßo: {props.nome}</p>.", s:"function Feitico(props){return <p>Feiti√ßo: {props.nome}</p>;}"},
                    {d:"Use o seu componente 'Feitico' com um nome.", c:"Invoque o seu componente 'Feitico' passando-lhe a prop nome='Igni√ß√£o'.", s:"<Feitico nome='Igni√ß√£o' />"},
                    {d:"JSX permite usar JavaScript dentro do HTML. Calcule o custo de um feiti√ßo.", c:"Dentro de um <div>, exiba 'Custo: {10 * 5} de mana'.", s:"<div>Custo: {10*5} de mana</div>"},
                    {d:"Componentes de classe s√£o uma forma mais antiga, mas poderosa, de magia.", c:"Crie um componente de classe 'Grimorio' que renderiza um <h2>Meu Grim√≥rio</h2>.", s:"class Grimorio extends React.Component{render(){return <h2>Meu Grim√≥rio</h2>;}}"},
                    {d:"O estado (state) permite que os componentes lembrem-se de informa√ß√µes.", c:"Num componente de classe, defina um estado inicial: state = { paginas: 50 }.", s:"state={paginas:50}"},
                    {d:"Use o estado para exibir informa√ß√£o din√¢mica.", c:"Dentro do m√©todo render, exiba 'P√°ginas: {this.state.paginas}'.", s:"<p>P√°ginas: {this.state.paginas}</p>"},
                    {d:"Os 'Hooks' s√£o a forma moderna de usar estado em componentes funcionais. O 'useState' √© o primeiro.", c:"Dentro de um componente funcional, declare um estado 'mana' com valor 100 usando useState.", s:"const [mana, setMana] = useState(100);"},
                    {d:"Exiba o estado do seu Hook.", c:"Retorne um <p>Mana: {mana}</p>.", s:"<p>Mana: {mana}</p>"},
                    {d:"Renderize uma lista de feiti√ßos a partir de um array.", c:"Dado um array ['Fogo', 'Gelo'], use .map para criar um <li> para cada feiti√ßo.", s:"['Fogo','Gelo'].map(f=><li key={f}>{f}</li>)"},
                    {d:"Eventos em React s√£o nomeados em camelCase, como 'onClick'.", c:"Crie um bot√£o com um evento onClick que chama uma fun√ß√£o 'lancarFeitico'.", s:"<button onClick={lancarFeitico}>Lan√ßar</button>"},
                    {d:"Use uma fun√ß√£o de seta para definir o manipulador de eventos diretamente.", c:"Crie um bot√£o que, ao ser clicado, exibe um alert('Boom!').", s:"<button onClick={()=>alert('Boom!')}>Lan√ßar</button>"},
                    {d:"Renderize conte√∫do condicionalmente. Se 'mana' for maior que 0, mostre 'Pode lan√ßar'.", c:"Use o operador tern√°rio: {mana > 0 ? <p>Pode lan√ßar</p> : <p>Sem mana</p>}.", s:"{mana>0?<p>Pode lan√ßar</p>:<p>Sem mana</p>}"},
                    {d:"Estilize os seus componentes em linha.", c:"Crie um <div> com um atributo style que define a sua cor como 'purple'.", s:"<div style={{color:'purple'}}>Texto Roxo</div>"},
                    {d:"Fragments permitem agrupar elementos sem adicionar um n√≥ extra ao DOM.", c:"Agrupe um h1 e um p dentro de um Fragment (<> ... </>).", s:"<><h1>T√≠tulo</h1><p>Par√°grafo</p></>"}
                ];
                return { dialogue: data[i].d, challenge: data[i].c, solution: data[i].s };
            }
            function getNodeLevel(i) { /* Retorna dados da fase Node */
                const data = [
                    {d:"Node.js permite que o JavaScript corra no lado do servidor. O primeiro passo √© importar um m√≥dulo. Importe o m√≥dulo 'http'.", c:"Escreva o c√≥digo para importar o m√≥dulo http: const http = require('http');", s:"const http=require('http');"},
                    {d:"Crie um servidor Arcano. Ele ir√° escutar por pedidos.", c:"Use http.createServer() e guarde o resultado numa vari√°vel 'servidor'.", s:"const servidor=http.createServer();"},
                    {d:"Dentro do createServer, precisa de uma fun√ß√£o para lidar com os pedidos.", c:"Passe uma fun√ß√£o (req, res) => {} para o createServer.", s:"http.createServer((req,res)=>{});"},
                    {d: "Fa√ßa o servidor responder. Dentro da fun√ß√£o, use res.end().", c: "Use res.end('O servidor responde.') para terminar o pedido.", s: "res.end('O servidor responde.')"},
                    {d: "Todo o servidor precisa de uma porta para escutar.", c: "Fa√ßa o servidor escutar na porta 3000: servidor.listen(3000);", s: "servidor.listen(3000);"},
                    {d: "Express.js simplifica a cria√ß√£o de servidores. Primeiro, importe-o.", c: "Importe o express: const express = require('express');", s: "const express=require('express');"},
                    {d: "Depois, crie a sua aplica√ß√£o Express.", c: "Crie uma aplica√ß√£o: const app = express();", s: "const app=express();"},
                    {d: "Defina uma rota para a p√°gina inicial ('/').", c: "Use app.get('/', (req, res) => {});", s: "app.get('/',(req,res)=>{});"},
                    {d: "Envie uma resposta para essa rota.", c: "Dentro da rota, use res.send('<h1>Bem-vindo √† Academia</h1>');", s: "res.send('<h1>Bem-vindo √† Academia</h1>');"},
                    {d: "Inicie o servidor Express.", c: "Fa√ßa a aplica√ß√£o escutar na porta 3000: app.listen(3000);", s: "app.listen(3000);"},
                    {d: "Crie outra rota para os feiti√ßos.", c: "Crie uma rota GET para '/feiticos'.", s: "app.get('/feiticos',(req,res)=>{});"},
                    {d: "Responda na rota de feiti√ßos com uma lista.", c: "Envie uma resposta JSON: res.json(['Fogo', 'Gelo']);", s: "res.json(['Fogo','Gelo']);"},
                    {d: "Use os par√¢metros da rota para obter um feiti√ßo espec√≠fico.", c: "Crie uma rota GET para '/feiticos/:nome'.", s: "app.get('/feiticos/:nome');"},
                    {d: "Acesse o par√¢metro 'nome' dentro da rota.", c: "Use req.params.nome para obter o nome do feiti√ßo.", s: "const nome=req.params.nome;"},
                    {d: "O 'Nodemon' √© um golem que reinicia o seu servidor automaticamente. A sua instala√ß√£o √© um feiti√ßo de terminal.", c: "Como instalaria o nodemon globalmente com npm?", s: "npm install -g nodemon"}
                ];
                return { dialogue: data[i].d, challenge: data[i].c, solution: data[i].s };
            }
            function getApiSqlLevel(i) { /* Retorna dados da fase API/SQL */
                const data = [
                    {d:"APIs permitem que mundos diferentes comuniquem. O feiti√ßo 'fetch' √© a sua ferramenta principal.", c:"Use fetch() para fazer um pedido a 'api/feiticos'.", s:"fetch('api/feiticos');"},
                    {d:"O 'fetch' retorna uma Promise. Use '.then()' para processar a resposta.", c:"Adicione .then(response => response.json()) para converter a resposta para JSON.", s:".then(response=>response.json())"},
                    {d:"Use um segundo '.then()' para trabalhar com os dados.", c:"Adicione .then(dados => console.log(dados)) para ver os dados na consola.", s:".then(dados=>console.log(dados))"},
                    {d:"Bancos de dados guardam o conhecimento. SQL √© a sua linguagem. Selecione todos os feiti√ßos da tabela 'feiticos'.", c:"Escreva a consulta SQL: SELECT * FROM feiticos;", s:"SELECT * FROM feiticos;"},
                    {d:"Selecione apenas os nomes dos feiti√ßos.", c:"Escreva a consulta: SELECT nome FROM feiticos;", s:"SELECT nome FROM feiticos;"},
                    {d:"Filtre os feiti√ßos. Selecione apenas aqueles do tipo 'Fogo'.", c:"Use a cl√°usula WHERE: SELECT * FROM feiticos WHERE tipo = 'Fogo';", s:"SELECT * FROM feiticos WHERE tipo='Fogo';"},
                    {d:"Insira um novo feiti√ßo na sua tabela.", c:"Use INSERT INTO: INSERT INTO feiticos (nome, tipo) VALUES ('Meteoro', 'Fogo');", s:"INSERT INTO feiticos(nome,tipo)VALUES('Meteoro','Fogo');"},
                    {d:"O poder pode corromper. Atualize um feiti√ßo existente.", c:"Use UPDATE: UPDATE feiticos SET tipo = 'Arcano' WHERE nome = 'Meteoro';", s:"UPDATE feiticos SET tipo='Arcano'WHERE nome='Meteoro';"},
                    {d:"Alguns feiti√ßos devem ser esquecidos. Apague um registo.", c:"Use DELETE FROM: DELETE FROM feiticos WHERE nome = 'Meteoro';", s:"DELETE FROM feiticos WHERE nome='Meteoro';"},
                    {d:"Ordene os seus resultados. Liste os feiti√ßos por ordem alfab√©tica.", c:"Use ORDER BY: SELECT nome FROM feiticos ORDER BY nome ASC;", s:"SELECT nome FROM feiticos ORDER BY nome ASC;"},
                    {d:"REST √© uma filosofia de design de APIs. GET, POST, PUT, DELETE s√£o os seus verbos. Como obteria um recurso?", c:"Qual verbo HTTP √© usado para obter dados de uma API?", s:"GET"},
                    {d:"Como criaria um novo recurso?", c:"Qual verbo HTTP √© usado para criar um novo feiti√ßo numa API?", s:"POST"},
                    {d:"JSON √© o pergaminho de elei√ß√£o para transportar dados de APIs.", c:"Escreva um objeto JSON simples com 'nome': 'Cura' e 'custo': 20.", s:`{"nome":"Cura","custo":20}`},
                    {d:"Autentica√ß√£o √© a chave para √°reas secretas. Muitas APIs usam 'Bearer Tokens'.", c:"Num cabe√ßalho de pedido, como se pareceria um 'Authorization' com um token?", s:"Authorization: Bearer <seu_token>"},
                    {d:"Junte tudo. Busque dados de uma API e depois insira-os no seu banco de dados.", c:"Que duas tecnologias usaria para buscar dados de uma API externa e guard√°-los permanentemente?", s:"Fetch e SQL"}
                ];
                return { dialogue: data[i].d, challenge: data[i].c, solution: data[i].s };
            }

            function getPythonLevel(i) { /* Retorna dados da fase Python */
                const data = [
                    {d:"Python √© uma magia poderosa e direta. O primeiro c√¢ntico exibe uma mensagem no √©ter.", c:"Use a fun√ß√£o print() para exibir 'Ol√°, Mundo Serpente'.", s:`print("Ol√°, Mundo Serpente")`},
                    {d:"Guarde ess√™ncia m√°gica em vari√°veis.", c:"Crie uma vari√°vel 'nome' e atribua a ela o valor 'Arcanecoder'.", s:`nome = "Arcanecoder"`},
                    {d:"Combine texto e vari√°veis para sauda√ß√µes personalizadas.", c:"Use a fun√ß√£o print() para exibir 'Bem-vindo, ' e o valor da vari√°vel 'nome'.", s:`print("Bem-vindo, " + nome)`},
                    {d:"A matem√°tica tamb√©m √© magia. Calcule seu poder.", c:"Crie uma vari√°vel 'mana' com o valor 100 e subtraia 15 dela.", s:`mana = 100 - 15`},
                    {d:"Encapsule feiti√ßos em fun√ß√µes para reutiliz√°-los.", c:"Defina uma fun√ß√£o chamada 'conjurar' que imprime 'Feiti√ßo lan√ßado!'.", s:`def conjurar():\n    print("Feiti√ßo lan√ßado!")`},
                    {d:"Para usar uma fun√ß√£o, voc√™ deve cham√°-la.", c:"Chame a fun√ß√£o 'conjurar()' que voc√™ acabou de criar.", s:`conjurar()`},
                    {d:"Listas s√£o como bolsas de ingredientes, guardando v√°rios itens.", c:"Crie uma lista chamada 'itens' contendo 'po√ß√£o' e 'pergaminho'.", s:`itens = ["po√ß√£o", "pergaminho"]`},
                    {d:"Voc√™ pode pegar um item espec√≠fico da sua bolsa pela sua posi√ß√£o.", c:"Use o √≠ndice para imprimir o primeiro item da sua lista 'itens'.", s:`print(itens[0])`},
                    {d:"Dicion√°rios guardam conhecimento em pares de chave e valor, como um besti√°rio.", c:"Crie um dicion√°rio 'grimorio' com a chave 'nome' valendo 'Tomo Arcano'.", s:`grimorio = {"nome": "Tomo Arcano"}`},
                    {d:"Consulte seu besti√°rio usando a chave para obter o valor.", c:"Imprima o valor associado √† chave 'nome' do seu dicion√°rio 'grimorio'.", s:`print(grimorio["nome"])`},
                    {d:"A magia precisa tomar decis√µes. Use if/else.", c:"Se 'mana' for maior que 50, imprima 'Poder suficiente'. Sen√£o, imprima 'Mana baixa'.", s:`if mana > 50:\n    print("Poder suficiente")\nelse:\n    print("Mana baixa")`},
                    {d:"Percorra todos os seus ingredientes com um la√ßo 'for'.", c:"Use um la√ßo 'for' para imprimir cada item da sua lista 'itens'.", s:`for item in itens:\n    print(item)`},
                    {d:"Crie feiti√ßos que aceitam alvos. Defina uma fun√ß√£o com um argumento.", c:"Crie uma fun√ß√£o 'saudar(aluno)' que imprime 'Ol√°, ' e o nome do aluno.", s:`def saudar(aluno):\n    print("Ol√°, " + aluno)`},
                    {d:"Feiti√ßos podem retornar resultados. Use a palavra-chave 'return'.", c:"Crie uma fun√ß√£o 'calcular_dano(nivel)' que retorna o n√≠vel multiplicado por 10.", s:`def calcular_dano(nivel):\n    return nivel * 10`},
                    {d:"Deixe anota√ß√µes para outros feiticeiros (ou para voc√™ mesmo) com coment√°rios.", c:"Escreva um coment√°rio em Python: # Este √© um feiti√ßo de invisibilidade", s:`# Este √© um feiti√ßo de invisibilidade`}
                ];
                return { dialogue: data[i].d, challenge: data[i].c, solution: data[i].s.replace(/\\n/g, '\n') };
            }

            function loadLevel() {
                if (gameState.currentLevel >= levels.length) {
                    endGame();
                    return;
                }
                const level = levels[gameState.currentLevel];
                const theme = chapterThemes[level.chapter];
                if (theme) {
                    const root = document.documentElement;
                    root.style.setProperty('--primary-glow', theme.primary);
                    root.style.setProperty('--secondary-glow', theme.secondary);
                }

                chapterTitle.textContent = level.chapter;
                challengeText.innerHTML = level.challenge;
                characterDialogue.textContent = level.dialogue;
                
                const progress = ((gameState.currentLevel + 1) / levels.length) * 100;
                progressBarFill.style.width = `${progress}%`;

                clearFeedback();
                codeInput.value = '';
                codeInput.focus();
            }

            function clearFeedback() {
                feedbackText.textContent = '';
                iconSuccess.style.display = 'none';
                iconError.style.display = 'none';
            }

            function handleSubmit() {
                const level = levels[gameState.currentLevel];
                const userAnswer = codeInput.value.trim();
                let isCorrect = false;

                try {
                    const normalize = (str) => str.replace(/\s+/g, '').replace(/'/g, '"').toLowerCase();
                    const normalizePython = (str) => str.replace(/\s+/g, '').replace(/'/g, '"');
                    
                    switch (level.type) {
                        case 'html':
                            isCorrect = normalize(userAnswer) === normalize(level.solution);
                            if (isCorrect) spellOutput.innerHTML += userAnswer;
                            break;
                        case 'css':
                            isCorrect = normalize(userAnswer).includes(normalize(level.solution));
                            if (isCorrect) styleTag.innerHTML += userAnswer;
                            break;
                        case 'js':
                        case 'js-async':
                            eval(userAnswer); 
                            isCorrect = level.validation();
                            break;
                        case 'react':
                        case 'node':
                        case 'api-sql':
                             isCorrect = normalize(userAnswer).includes(normalize(level.solution));
                             if(isCorrect) spellOutput.innerHTML += `<pre><code>${userAnswer.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</code></pre>`;
                             break;
                        case 'python':
                             isCorrect = normalizePython(userAnswer) === normalizePython(level.solution);
                             if(isCorrect) spellOutput.innerHTML += `<pre><code>${userAnswer.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</code></pre>`;
                             break;
                    }

                    if (isCorrect) {
                        feedbackText.textContent = "Feiti√ßo bem-sucedido!";
                        feedbackText.style.color = 'var(--success-color)';
                        iconSuccess.style.display = 'block';
                        iconError.style.display = 'none';
                        
                        gameState.currentLevel++;
                        localStorage.setItem('arcanecoderSave', JSON.stringify(gameState));

                        setTimeout(loadLevel, 1500);
                    } else {
                        throw new Error("O fluxo de mana n√£o est√° correto.");
                    }

                } catch (error) {
                    feedbackText.textContent = `Falha na conjura√ß√£o! Verifique o seu c√¢ntico.`;
                    feedbackText.style.color = 'var(--error-color)';
                    iconError.style.display = 'block';
                    iconSuccess.style.display = 'none';
                }
            }
            
            function endGame() {
                characterDialogue.textContent = "Dominou o Syllabus Arcano e tornou-se um Mestre Arcanecoder! O poder da cria√ß√£o est√° agora nas suas m√£os. Parab√©ns!";
                challengeText.textContent = "Fim do treino.";
                progressBarFill.style.width = `100%`;
                codeInput.style.display = 'none';
                submitButton.style.display = 'none';
            }

            // --- FEITI√áOS DE PORTABILIDADE ---

            function saveGameToFile() {
                try {
                    const stateToSave = JSON.stringify(gameState);
                    const blob = new Blob([stateToSave], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `arcanecoder-save-${Date.now()}.txt`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    clearFeedback();
                    feedbackText.textContent = "Progresso salvo em arquivo!";
                    feedbackText.style.color = 'var(--success-color)';
                } catch (error) {
                    clearFeedback();
                    feedbackText.textContent = "Erro ao salvar o progresso.";
                    feedbackText.style.color = 'var(--error-color)';
                }
            }

            function loadGameFromFile(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const loadedState = JSON.parse(e.target.result);
                        if (typeof loadedState.currentLevel === 'number' && loadedState.currentLevel >= 0 && loadedState.currentLevel < levels.length) {
                            gameState = loadedState;
                            localStorage.setItem('arcanecoderSave', JSON.stringify(gameState));
                            alert('Progresso carregado com sucesso! O grim√≥rio ser√° atualizado.');
                            location.reload();
                        } else {
                            throw new Error('Arquivo de save inv√°lido ou corrompido.');
                        }
                    } catch (error) {
                        alert(`Erro ao carregar o arquivo: ${error.message}`);
                    }
                };
                reader.readAsText(file);
                event.target.value = ''; // Permite carregar o mesmo arquivo novamente
            }

            // --- EVENT LISTENERS ---

            resetButton.addEventListener('click', () => {
                if (confirm('Tem certeza de que quer apagar todo o seu progresso local? Este feiti√ßo n√£o pode ser desfeito.')) {
                    localStorage.removeItem('arcanecoderSave');
                    location.reload();
                }
            });
            
            saveButton.addEventListener('click', saveGameToFile);
            
            importButton.addEventListener('click', () => {
                importFileInput.click();
            });

            importFileInput.addEventListener('change', loadGameFromFile);

            submitButton.addEventListener('click', handleSubmit);
            
            codeInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSubmit();
                }
            });
            
            loadLevel();
        });
    </script>
</body>
</html>

